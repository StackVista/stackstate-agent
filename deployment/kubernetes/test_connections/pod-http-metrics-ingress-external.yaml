apiVersion: v1
kind: Pod
metadata:
  name: shipping
  labels:
    name: shipping
    test: pod-http-metrics-ingress-external
spec:
  containers:
    - name: shipping
      image: weaveworksdemos/shipping:0.4.8
      ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: shipping
  labels:
    name: shipping
    test: pod-http-metrics-ingress-external
spec:
  type: ClusterIP
  ports:
    - port: 80
      protocol: TCP
  selector:
    name: shipping
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: ingress-nginx-external
    nginx.ingress.kubernetes.io/ingress.class: ingress-nginx-external
    nginx.ingress.kubernetes.io/proxy-body-size: 100m
  name: pod-http-metrics-ingress-external
  labels:
    test: pod-http-metrics-ingress-external
spec:
  rules:
  - host: pod-http-metrics-ingress-external.preprod.stackstate.io
    http:
      paths:
      - backend:
          service:
            name: shipping
            port:
              number: 80
        path: /
        pathType: Prefix
---
apiVersion: v1
kind: Pod
metadata:
  name: http-client
  labels:
    test: pod-http-metrics-ingress
spec:
  containers:
    - name: http-client
      image: julianosk/continuous-requests-py:1.2
      env:
        - name: URL
          value: "http://pod-http-metrics-ingress-external.preprod.stackstate.io/health/"
        - name: INTERVAL
          value: "2"
